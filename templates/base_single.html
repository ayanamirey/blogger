{% extends 'base.html' %}

{% block root_content %}
    <div class="container">
        <div class="entry-header">
            <div class="mb-5">
                <h1 class="entry-title m_b_2rem">
                    {% block header %} {% endblock %}
                </h1>
                <div class="d-flex">
                    <div class="entry-meta flex-grow-1">
                        <a class="author-avatar" href="#"><img src="/static/images/author-avata-2.jpg" alt=""></a>
                        <a href="{% url 'profiles:profile-details' %} }}">{{ article.author }}</a> in <a
                            href="archive.html">OneZero</a><br>
                        <span>{{ article.date }}</span>
                        <span class="middotDivider"></span>
                        <span class="readingTime" title="{{ article.time_of_read }} read">{{ article.time_of_read }} read</span>
                        <span class="svgIcon svgIcon--star">
                            <svg class="svgIcon-use" width="15" height="15">
                                <path d="M7.438 2.324c.034-.099.09-.099.123 0l1.2 3.53a.29.29 0 0 0 .26.19h3.884c.11 0 .127.049.038.111L9.8 8.327a.271.271 0 0 0-.099.291l1.2 3.53c.034.1-.011.131-.098.069l-3.142-2.18a.303.303 0 0 0-.32 0l-3.145 2.182c-.087.06-.132.03-.099-.068l1.2-3.53a.271.271 0 0 0-.098-.292L2.056 6.146c-.087-.06-.071-.112.038-.112h3.884a.29.29 0 0 0 .26-.19l1.2-3.52z"></path>
                            </svg>
                        </span>
                    </div>
                    {% if user.username|lower == article.author.username|lower %}
                        <div class="d-flex">
                            <form action="{% url 'articles:edit' article.slug %}" class="mr-1">
                                <button type="submit" class="btn btn-info">Edit</button>
                            </form>
                            <form method="get" action="{% url 'articles:delete' article.slug %}" class="ml-1">
                                <button type="button" class="btn btn-danger text" data-toggle="modal"
                                        data-target="#deleteModal">
                                    Delete
                                </button>
                                <div class="modal" id="deleteModal">
                                    <div class="modal-dialog modal-dialog-centered modal-sm ">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title">Delete</h4>
                                                <button type="button" class="close" data-dismiss="modal">&times;
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                Are you sure to delete the article?
                                            </div>
                                            <div class="modal-footer">
                                                <button type="submit" class="btn btn-danger">
                                                    Yes
                                                </button>
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                    No
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div> <!--end single header-->
        <!--    <figure class="image zoom mb-5">-->
        <!--        <img src="http://via.placeholder.com/1240x700" alt="post-title" />-->
        <!--    </figure>-->

        <article class="entry-wraper mb-2">
            <div class="entry-left-col">
                <div class="social-sticky">
                    <a href="#"><i class="icon-facebook"></i></a>
                    <a href="#"><i class="icon-twitter"></i></a>
                    <a href="#"><i class="icon-heart"></i></a>
                    <a href="#"><i class="icon-paper-plane"></i></a>
                </div>
            </div>
            <div class="entry-main-content">
                {% block content %}
                {% endblock %}
            </div>
            <div>
                {% block bottom %}
                {% endblock %}
            </div>

            {% include '_partials/article_author.html' %}
        </article> <!--entry-content-->

        <!--Begin post related-->
        {# include '_partials/related.html' #}
        <!--End post related-->
        <div class="entry-wraper">
            <!--Begin Comment-->
            <h4 class="font-weight-bold">Comments {{ comments_count }}</h4>
            {% if comments_count > 0 %}

                {% for comment in article.get_comments %}
                    {% if comment.status|lower == 'active' or comment.comment_set.all|length != 0 %}
                        {% include '_partials/_comment_item.html' %}
                        <div class="pl-4">
                            {% for comment in comment.comment_set.all %}
                                {% if comment.status|lower == 'active' %}
                                    {% include '_partials/_comment_item.html' %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endfor %}
            {% else %}
                <div class="text-center my-4 font-italic large">Write your first commit</div>
            {% endif %}

        </div>

        {% include '_partials/comment.html' %}
        <!--End Comment-->
    </div> <!--container-->
{% endblock %}

{% block jslibs %}
    <script>
        function replying(id_loop, parent_loop_id = 0) {
            let id = $(`#comment-${id_loop} div.p-0 div.my-1`).attr('id')
            if (Number(parent_loop_id) !== 0) {
                id = $(`#comment-${parent_loop_id} div.p-0 div.my-1`).attr('id')
            }
            let reply = $(`#reply-comment-${id_loop}`)
            if (reply.is(':empty')) {
                reply.append(
                    `<form action="{% url 'articles:add-comment' article.id %}" method="post" class="comment-form"">
                    {% csrf_token %}
                    <p class="comment-form-comment">
                        <textarea name="content" cols="60" rows="2" required="" style="resize: vertical; min-height: 65px;"></textarea>
                    </p>
                    <p class="form-submit">
                        <input type="hidden" name="parent" value="${id}">
                        <input name="submit" type="submit" id="submit" class="btn btn-success"
                               value="Post Comment">
                        <input type="button" onclick="hideReply(${id_loop})" value="Cancel" class="btn btn-outline-dark text-dark ml-3">
                    </p>
                </form>`
                )
            }
        }

        function hideReply(id_loop) {
            $(`#reply-comment-${id_loop}`).empty()
        }
    </script>
{% endblock %}
